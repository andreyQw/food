$(function(){$("#modal").load("/tpl/modal.tpl",function(){$(".js-get-modal").on("click",function(o){o.preventDefault();$(".modal-overlay:first").addClass("modal-overlay--open");$(".modal").removeClass("modal--open");$("."+$(this).attr("data-modal")).addClass("modal--open")});$(".js-close-modal").on("click",function(o){o.preventDefault();$(this).parents(".modal").removeClass("modal--open");$(".modal-overlay").removeClass("modal-overlay--open")});$(window).on("keydown",function(o){if(o.keyCode==27){$(".modal").removeClass("modal--open");$(".modal-overlay").removeClass("modal-overlay--open");$(".modal-constructor").remove()}});var k=getParameterByName("forgotPassword");if(k!=""){$(".modal-forgot > a").click()}var n=getParameterByName("md_email");var l=getParameterByName("md_id");if(n!=""&&l!=""){$(".modal-unsubscribe > a").click();$.post("/ajax?action=unsubscribe",{md_email:n,md_id:l})}if($("#org-reviews").length){var j=getParameterByName("review");if(j!=""&&!$(".main-header_user .tooltip").length){$(".modal-login > a").click()}}if($.cookie("zakaCityDetect")==undefined){if(location.pathname=="/"){$.getScript("https://api-maps.yandex.ru/2.1/?lang=ru_RU",function(){ymaps.ready(function(){ymaps.geolocation.get({autoGeocode:true,provider:"yandex"}).then(geodetect)})})}var m=window.location.hostname.split(".").slice(-2).join(".");$.cookie("zakaCityDetect",true,{expires:1000,path:"/",domain:"."+m})}setImputMask();$("#card_pan").mask("0000 0000 0000 0000 0000");$("#card_cvc").mask("000")});$(".js-toggle-tooltip").on("click",function(j){j.preventDefault();var k=$(this).parents(".tooltip");if(k.hasClass("tooltip--open")){k.removeClass("tooltip--open")}else{$(".tooltip").removeClass("tooltip--open");k.addClass("tooltip--open")}});$(".js-close-tooltip").on("click",function(j){j.preventDefault();$(this).parents(".tooltip").removeClass("tooltip--open")});$(document).on("click",function(j){if(!$(j.target).closest(".ingredients-box").length){if(!$(j.target).closest(".tooltip--open").length){j.stopPropagation();$(".tooltip--open").removeClass("tooltip--open")}if(!$(j.target).closest(".live-search-box").length){j.stopPropagation();$(".setip").remove()}if(!$(j.target).closest(".header_street").length){j.stopPropagation();$(".setip_street").remove()}if(!$(j.target).closest(".menu-search-box").length){j.stopPropagation();$(".setip-menu").remove()}if(!$(j.target).closest(".address-live-box").length){j.stopPropagation();$(".address-live-box").hide()}}});if($(".main-header_user .tooltip").length){var i=$(".tooltip_title--star .notice");if($(i).length&&$(".cart-pane").length){var f=parseInt($(i).text());if(f>0){$(".cart-pane .tooltip .cart-pane__number").text(f);$(".cart-pane .tooltip_content .scroll").html($(".tooltip_title--star").next(".tooltip_content").html());$(".cart-pane .notice-item--empty, .cart-pane .tooltip_content button").remove();$(".cart-pane .tooltip").show()}}$(".main-header_user .notice-item--empty, .main-header_user .btn--notice, .cart-pane .btn--notice").hide();$(".main-header_user .list, .cart-pane .tooltip_content").each(function(){var j=$(this).find(".notice-item").length;$(this).find(".notice-item:gt(2)").hide();if(j>3){$(this).find(".btn--notice").show()}if(j==0){$(this).find(".notice-item--empty").show()}});$(".main-header_user .btn--notice, .cart-pane .btn--notice").on("click",function(){$(this).hide();$(this).closest("div").find(".notice-item:gt(2)").slideDown();return false});$(".js-delete-notice").on("click",function(l){l.preventDefault();var j=$(this).attr("data-type"),n=$(this).attr("data-id");if(j=="org"){setFavorite(n,0)}else{if(j=="msg"){var m=$(".tooltip_title--message .notice");var k=parseInt($(m).text());if(k>1){$(m).text(k-1)}else{$(m).remove()}$.get("/ajax?action=noticeRemove&id="+n+"&r="+Math.random())}}$(this).closest(".notice-item").nextAll(".notice-item:hidden").first().slideDown(200);$(this).closest(".notice-item").slideUp(200,function(){if($(this).closest(".list").find(".notice-item:visible").length==0){$(this).closest(".list").find(".notice-item--empty").slideDown()}if($(this).closest(".notice-item").nextAll(".notice-item:hidden").length==0){$(this).closest(".list").find(".btn--notice").slideUp()}$(this).remove()});return false})}var c=$(".main_bxslider");if($(c).length){$(".js-tab-control").on("click",function(k){k.preventDefault();var j=$(this).parents(".js-tab-container");j.find(".js-tab-control").removeClass("active");$(this).addClass("active");j.find(".js-tab").removeClass("js-tab--open");j.find("."+$(this).attr("data-tab")).addClass("js-tab--open").css("display","none").fadeIn(400)});$(c).bxSlider({controls:false,auto:true,pause:7000,onSlideBefore:function(k){var j=$(k).attr("class");if(j=="animation2"){$(".animage1").css({right:"-200px",opacity:"0"}).animate({opacity:1,right:"40px"},600);$(".animage2").css({right:"100px",opacity:".8"}).animate({opacity:1,right:"0px"},600)}else{if(j=="animation3"){$(".animage3").css({right:"-200px",opacity:"0"}).animate({opacity:1,right:"40px"},600);$(".animage4").css({right:"100px",opacity:".8"}).animate({opacity:1,right:"0px"},600)}else{if(j=="animation4"){$(".animage7").hide();$(".animage6").css("top","-160px");$(".animage5").css("top","50px")}}}},onSlideAfter:function(k){var j=$(k).attr("class");if(j=="animation4"){$(".animage6").animate({top:"30px"},600,function(){$(".animage7").delay(500).fadeIn(400)});$(".animage5").animate({top:"185px"},600)}}});if($(".carousel li").length>2){$(".carousel").bxSlider({slideWidth:5000,minSlides:3,maxSlides:3,slideMargin:30,pager:false,moveSlides:1,infiniteLoop:true})}$(".promos img").each(function(){var j=$(this).attr("data-src");if(j!=""){$(this).attr("src",j)}})}$(".promo_bxslider").bxSlider({controls:false});$("#city-select").find("a").click(function(k){k.preventDefault();var j=$(this).attr("href"),l=window.location.pathname.split("/");if(l.length>0){if(l[1]=="restaurants"||l[1]=="food"){j+="/"+l[1];if(l.length>1&&l[2]!="comments"&&l[2]!="menu"&&l[2]!="info"){j+="/"+l[2]}j+=window.location.search}}window.location=j});var e=$(".sort-block--interactive");if($(e).length){$(e).find(".sort-block_header").on("click",function(k){k.preventDefault();var j=$(this).parents(".sort-block--interactive");if($(j).hasClass("sort-block--interactive--open")){$(j).find(".sort-block_content").slideUp("fast",function(){$(j).removeClass("sort-block--interactive--open")})}else{$(j).find(".sort-block_content").slideDown("fast",function(){$(j).addClass("sort-block--interactive--open")})}return false});$(".sort-block--interactive .active").closest(".sort-block--interactive").addClass("sort-block--interactive--open")}itemButton();$(window).bind("load",function(){setTimeout(function(){$(window).bind("popstate",function(){getUrl(window.location,true)})},0)});if($("#orgs").length){var g=true;$('aside input[name!="cuisines"], .select.sort input').on("change",function(j){j.preventDefault();orgFilter();g=true});$('aside input[name="cuisines"]').on("change",function(){if($(this).is(":checked")&&$('aside input[name="cuisine"]:checked').length>0){$('aside input[name="cuisine"]').prop("checked",false);orgFilter();g=true}else{$(this).prop("checked",true)}});topButton(230);$(window).scroll(function(){if($(window).scrollTop()+$(window).height()>$("#contentBox").height()-1000&&g){g=false;var k=$("#infinity");var j=$(k).attr("data-next");if(typeof j==="undefined"){return}$(k).remove();$.get(j,function(l){$(l).appendTo("#contentBox");g=true})}})}var h=$("#restoran-page");if($(h).length){canOrderBonus();var b=localStorage.getItem("linkOrgList");if(b!=null){$(".main-header .logo a").attr("href",b)}orgClosing();if($("#org-info").length){$.getScript("//yastatic.net/share/share.js")}topButton(410);var d=$(".cafe-item_menu");if($(d).length){$(".list-org_sidebar form").submit(function(l){l.preventDefault();var j=$(".list-org_sidebar form input").val(),k=$(".list-org_sidebar form").attr("action");if(j==""||k==""){return}$(".list-org_sidebar a").removeClass("active");getUrl(k+"?s="+j,false)});$(".list-org_sidebar a:not(.parent)").on("click",function(k){k.preventDefault();$(".list-org_sidebar a").removeClass("active");$(this).addClass("active");$(this).closest(".sort-block").find(".parent").addClass("active");$(".list-org_sidebar form input").val("");var j=$(this).attr("href");getUrl(j,false);$("html, body").animate({scrollTop:$("#contentBox").offset().top},500)})}if($(h).attr("data-work")=="0"&&document.referrer.indexOf(document.domain)==-1){if($(d).length){$.get("/objects?action=getOrgWorkCap&id="+$(h).attr("data-id"),function(j){if(j!="false"){$(j).appendTo("body");$(".modal-fix .js-close-modal").on("click",function(k){k.preventDefault();$(this).parents(".modal-fix").remove();$(".modal-overlay-fix").remove()})}})}}$(".menu-live-search").keyup(function(k){if($.inArray(k.which,[13,37,38,39,40])>=0){return}if($(this).val().length>2){var j=$(this).closest(".menu-live-box");$.post("/ajax?action=menu.search",{text:$(this).val(),org_id:$("#restoran-page").attr("data-id")},function(n){var l=$.parseJSON(n),m="";$.each(l,function(o,p){m+='<a href="#" class="setip_menu" onclick="return menuLiveSelect(this);"><img src="'+p.image+'"><span>'+p.name+"</span></a>"});if(m==""){$(j).find(".setip-menu").remove()}else{if($(j).find(".setip-menu").length){$(j).find(".setip-menu").html(m)}else{$('<div class="setip-menu">'+m+"</div>").appendTo(j)}}})}else{$(this).closest(".menu-live-box").find(".setip-menu").remove()}}).keydown(function(j){hintSelector(j,".menu-live-box")})}$(".live-search").keyup(function(k){if($.inArray(k.which,[13,37,38,39,40])>=0){return}if($(this).val().length>2){var j=$(this).closest(".live-search-box");$.post("/ajax?action=org.search",{text:$(this).val()},function(n){var l=$.parseJSON(n),m="";$.each(l,function(o,p){m+='<a href="'+p.url+'" class="setip_org"><img src="'+p.image+'"><span>'+p.name+"</span></a>"});if(m==""){$(j).find(".setip").remove()}else{if($(j).find(".setip").length){$(j).find(".setip").html(m)}else{$('<div class="setip">'+m+"</div>").appendTo(j)}}})}else{$(this).closest(".live-search-box").find(".setip").remove()}}).keydown(function(j){hintSelector(j,".live-search-box")});selectInit();var a="";$(".header_street input").click(function(){$(".header_street input").removeClass("error");if(!$(".main-header_user").length){return}if(a.length>5){$(".setip_street").remove();$('<div class="setip_street"><div class="scroll">'+a+"</div></div>").appendTo(".header_street");return}$.get("/ajax?action=customer.address.list&r="+Math.random(),function(l){if(l=="false"){return}var j=$.parseJSON(l),k="";$.each(j,function(n,m){k+='<a href="#" onclick="return selectedAddress('+m.id+');">'+m.name+"</a>"});if(k==""){$(".setip_street").remove()}else{if($(".setip_street").length){$(".setip_street .scroll").html(k)}else{$('<div class="setip_street"><div class="scroll">'+k+"</div></div>").appendTo(".header_street")}a=k}})}).keyup(function(j){if($.inArray(j.which,[13,37,38,39,40])>=0){return}if($(this).val().length>2){$.post("/ajax?action=street.search",{search:$(this).val()},function(l){var k=$(".setip_street");if(l=="false"||l==""){$(k).remove();return}if($(k).length){$(k).find(".scroll").html(l)}else{$('<div class="setip_street"><div class="scroll">'+l+"</div></div>").appendTo(".header_street")}})}else{$(".setip_street").remove()}}).keydown(function(j){hintSelector(j,".header_street")});$(".header_house input").click(function(){$(this).removeClass("error");$(".setip_street").remove()});if($("#private-page").length){topButton(410);if($(".cafe-item_menu").length){$(".list-org_sidebar a:not(.parent)").on("click",function(k){k.preventDefault();$(".list-org_sidebar a").removeClass("active");$(this).addClass("active");$(this).closest(".sort-block").find(".parent").addClass("active");$(".list-org_sidebar form input").val("");var j=$(this).attr("href");getUrl(j,false);$("html, body").animate({scrollTop:$("#contentBox").offset().top},500)})}if($("#private-map").length){$.getScript("https://api-maps.yandex.ru/2.1/?lang=ru_RU",function(){var k=false,o=[],n=$("#private-map"),j=$("aside"),l=$.Callbacks(),m=(function(){var p=0;return function(){var t=1/(360/((p++*78)%360)),q=0.7,s=0.7,v=q,u=q,x=q,r=Math.floor(t*6),w=t*6-r;switch(r%6){case 5:u*=(1-s);x*=(1-w*s);break;case 0:u*=(1-(1-w)*s);x*=(1-s);break;case 3:v*=(1-s);u*=(1-w*s);break;case 4:v*=(1-(1-w)*s);u*=(1-s);break;case 2:v*=(1-s);x*=(1-(1-w)*s);break;case 1:v*=(1-w*s);x*=(1-s);break}return"#"+Math.floor(v*255).toString(16)+Math.floor(u*255).toString(16)+Math.floor(x*255).toString(16)+"44"}})();n.on("map",function(q,p){(k)?k.geoObjects.add(p):l.add(function(r){r.geoObjects.add(p)})}).on("unmap",function(q,p){(k)?k.geoObjects.remove(p):l.add(function(r){r.geoObjects.remove(p)})});ymaps.ready(function(){j.find(".sort-block_content a").each(function(s){var w=$(this),x=w.data("polygon"),t;if(x){var y=new ymaps.GeoObjectCollection();for(t in x){var u=x[t],r={fillColor:m(),geodesic:true},q={hintContent:u.name},v=false;if(+u.type==1){u.coords[1]=ymaps.coordSystem.geo.getDistance(u.coords[0],[u.coords[0][0]+u.coords[1],u.coords[0][1]]);v=new ymaps.Circle(u.coords,q,r)}else{if(+u.type==2){v=new ymaps.Rectangle(u.coords,q,r)}else{v=new ymaps.Polygon([u.coords,[]],q,r)}}y.add(v)}w.data("ygroup",y)}});j.find(".sort-block_header").each(function(){var q=$(this),r=q.data("placemark");var p=$(this).text();if(r&&p){n.trigger("map",new ymaps.Placemark(r,{hintContent:p,balloonContent:p}))}});$("aside .h-tooltip").click(function(){if(o.length){n.trigger("unmap",o.shift())}var p=$(this).data("ygroup");o.push(p);n.trigger("map",p);return false});ymaps.geocode(n.data("city")).then(function(p){k=new ymaps.Map(n.get(0),{center:p.geoObjects.get(0).geometry.getCoordinates(),zoom:10});l.fire(k)})})})}if($("#private-chart").length){$.getScript("/js/jquery.flot.js",function(){var j=$.plot("#private-chart",[{data:pgraf.data,color:"#fe9601"}],{series:{lines:{show:true},points:{show:true,lineWidth:7,fill:true,fillColor:"#fe9601"}},grid:{hoverable:true,clickable:true,borderWidth:{top:0,right:0,bottom:2,left:0}},xaxis:{ticks:pgraf.ticks}});$("#private-chart").bind("plothover",function(m,o,l){if(l){var k=l.datapoint[0].toFixed(2),n=l.datapoint[1].toFixed(2);$("#private-chart-tooltip").html(parseInt(n)).css({top:l.pageY-20,left:l.pageX+25}).fadeIn(200)}else{$("#private-chart-tooltip").hide()}})})}}if($("#cart_form").length){setStreetLive()}});function orgClick(){var a=location.pathname+location.search;localStorage.setItem("linkOrgList",a);return true}function removeFromLast(b,a){$.post("/ajax?action=org.remove.last",{id:b},function(){orgFilter()});$(a).closest(".restoran-item").slideUp();return false}function checkCartOpen(){var d=$(".need_minimum_summa");if($(d).length){var c=parseInt($(".cart-pane__number:first").text()),b=parseFloat($(".cart-pane__sum").text()),a=parseFloat($(d).attr("data-summa"));if(c==1&&b==0&&a>0){$(".need_minimum").text(a+" "+decOfNum(a,["рубль","рубля","рублей"]));$(".modal-need_minimum > a").click();dataLayer.push({event:"nomoney_nohoney"});return false}}return true}function selectedAddress(a){$.cookie("zakaPoint",a,{expires:1000,path:"/"});$(".modal-loader a").click();location.reload();return false}function streetSelected(a){$('.header_street input, #cart_form input[name="street"]').val($(a).text());$(".address-live-box").hide();$(".setip_street").remove();$('.header_house input, #cart_form input[name="home"]').val("").focus();return false}function inputedAddress(){var f=$(".header_street input"),d=$(".header_house input");var e=$("#current-city").text(),c=$(f).val(),b=$(d).val();if(c==""){$(f).addClass("error");$(".main-header_bottom .container").shake();return false}if(b==""){$(d).addClass("error");$(".main-header_bottom .container").shake();return false}if($(f).attr("data-value")==c&&$(d).attr("data-value")==b){window.location="/restaurants";return false}var a=e+", "+c+", дом "+b;if(e.indexOf("область")==-1){a="Город "+a}$.ajax({url:"https://geocode-maps.yandex.ru/1.x/?format=json&geocode="+encodeURIComponent(a)+"&callback=?",type:"GET",dataType:"jsonp",jsonpCallback:"formJsonpCallback"});$(".modal-loader a").click();return false}function formJsonpCallback(g){var l=[],i,h,j={};if(g.response.GeoObjectCollection.featureMember.length>0){var d=g.response.GeoObjectCollection.featureMember;for(i in d){var f=d[i].GeoObject.metaDataProperty.GeocoderMetaData.kind;if(f=="house"){l.push(d[i])}}}if(l.length==1){h=searchGeoParam(l[0],"pos");var c=h.split(" ");j.name=searchGeoParam(l[0],"formatted");j.coord=c[1]+","+c[0];j.street=searchGeoParam(l[0],"ThoroughfareName");if(j.street==""){j.street=searchGeoParam(l[0],"DependentLocalityName")}j.house=searchGeoParam(l[0],"PremiseNumber");$.post("/ajax?action=address.new",j,function(m){if($.isNumeric(m)){$.cookie("zakaPoint",m,{expires:1000,path:"/"});window.location="/restaurants";return false}window.location.reload()})}else{if(l.length>1){$(".rectification_address").html("");for(i in l){h=searchGeoParam(l[i],"pos");var k=searchGeoParam(l[i],"AddressLine"),e=searchGeoParam(l[i],"ThoroughfareName"),a=searchGeoParam(l[i],"PremiseNumber"),b=searchGeoParam(l[i],"formatted");if(e==""){e=searchGeoParam(l[i],"DependentLocalityName")}c=h.split(" ");$('<a href="#" data-coord="'+c[1]+","+c[0]+'" data-street="'+e+'" data-house="'+a+'" data-name="'+b+'">'+k+"</a>").appendTo(".rectification_address")}$(".modal-rectification > a").click();$(".rectification_address a").click(function(m){m.preventDefault();$(".modal-loader a").click();j.name=$(this).attr("data-name");j.coord=$(this).attr("data-coord");j.street=$(this).attr("data-street");j.house=$(this).attr("data-house");$.post("/ajax?action=address.new",j,function(n){if($.isNumeric(n)){$.cookie("zakaPoint",n,{expires:1000,path:"/"});window.location="/restaurants";return false}window.location.reload()})})}else{$(".modal-noaddr > a").click()}}}function removeAddress(b,a){$(a).parents(".adress-item").slideUp(200);$.get("/ajax?action=removeAddress&id="+b+"&r="+Math.random());return false}function addAddress(f){var g=$("#current-city").text(),e=$("#in3").val(),d=$("#in4").val(),a=$(f).find('input[name="building"]').val();if(e==""||d==""){return false}var c=g+", "+e+", дом "+d+(a==""?"":"/"+a);if(g.indexOf("область")==-1){c="Город "+c}$.ajax({url:"https://geocode-maps.yandex.ru/1.x/?format=json&geocode="+encodeURIComponent(c)+"&callback=?",type:"GET",dataType:"jsonp",jsonpCallback:"userJsonpCallback"});$(".modal-loader a").click();return false}function userJsonpCallback(g){var l=[].key,h,i={};if(g.response.GeoObjectCollection.featureMember.length>0){var d=g.response.GeoObjectCollection.featureMember;for(j in d){var f=d[j].GeoObject.metaDataProperty.GeocoderMetaData.kind;if(f=="house"){l.push(d[j])}}}if(l.length==1){h=searchGeoParam(l[0],"pos");var c=h.split(" ");i.name=searchGeoParam(l[0],"formatted");i.coord=c[1]+","+c[0];i.street=searchGeoParam(l[0],"ThoroughfareName");if(i.street==""){i.street=searchGeoParam(l[0],"DependentLocalityName")}i.house=searchGeoParam(l[0],"PremiseNumber");i.title=$("#in1").val();i.flat=$("#in4").val();i.comment=$("#in5").val();$.post("/ajax?action=address.new",i,function(){location.reload()})}else{if(l.length>1){$(".rectification_address").html("");for(var j in l){h=searchGeoParam(l[j],"pos");var k=searchGeoParam(l[j],"AddressLine"),e=searchGeoParam(l[j],"ThoroughfareName"),a=searchGeoParam(l[j],"PremiseNumber"),b=searchGeoParam(l[j],"formatted");if(e==""){e=searchGeoParam(l[j],"DependentLocalityName")}c=h.split(" ");$('<a href="#" data-coord="'+c[1]+","+c[0]+'" data-street="'+e+'" data-house="'+a+'" data-name="'+b+'">'+k+"</a>").appendTo(".rectification_address")}$(".modal-rectification > a").click();$(".rectification_address a").click(function(m){m.preventDefault();$(".modal-loader a").click();i.name=$(this).attr("data-name");i.coord=$(this).attr("data-coord");i.street=$(this).attr("data-street");i.house=$(this).attr("data-house");i.title=$("#in1").val();i.flat=$("#in4").val();i.comment=$("#in5").val();$.post("/ajax?action=address.new",i,function(){location.reload()})})}else{$(".modal-noaddr > a").click()}}$(".header_button").prop("disabled",false)}function searchGeoParam(c,d){var b="";for(var a in c){if(typeof c[a]==="object"){b=searchGeoParam(c[a],d);if(b!=""){return b}}if(a==d){return c[a]}}return b}function bonusShare(a,b){if(a=="tw"){$(b).attr("href","https://twitter.com/intent/tweet?url=https://"+location.host+"&text="+$("title").text())}if(a=="fb"){$(b).attr("href","https://www.facebook.com/sharer/sharer.php?u=https://"+location.host)}if(a=="vk"){$(b).attr("href","http://vk.com/share.php?url=https://"+location.host)}$.post("/ajax?action=bonus.share",{network:a},function(c){if(c=="allready"){$(".modal-bonus-allready a").click()}else{if(c=="true"){$(".modal-bonus-add a").click()}}});return true}function orgFilter(){var f=$('aside input[name="cuisine"]:checked');var b="/"+$("#orgs").attr("data-type"),d,a=[],g=[],e=$(f).length;if(e>0){if(e==1){d=$(f).val();if(d!==undefined){b+="/"+d}}else{$(f).each(function(){a.push($(this).attr("data-id"))});if(a.length>0){g.push("cuisines="+a.join(","))}}$('aside input[name="cuisines"]').prop("checked",false)}else{$('aside input[name="cuisines"]').prop("checked",true)}var h=$("#distr-select").find("a.selected").attr("data-code");if(h!==undefined){b+=(d!==undefined?"/":"/all/")+h}$('aside input[type="checkbox"]:checked').each(function(){if($(this).attr("name")=="cuisine"){return}if($(this).attr("name")=="cuisines"){return}if($(this).val()==""){return}g.push($(this).attr("name")+"="+$(this).val())});var c=parseInt($(".select.sort input").val());if(c>1){g.push("sort="+c)}if(g.length>0){b+="?"+g.join("&")}getUrl(b,false)}function menuLiveSelect(b){var c=$(b).find("span").text();if(c==""){return}var a=$(".menu-live-box");$(a).find("input").val(c);$(a).find(".setip-menu").remove();$(a).submit();return false}function geodetect(a){var c={},d,b;$("#city-select").find(".find-list_select").each(function(){c[$(this).text()]=$(this).attr("href")});d=a.geoObjects.get(0).properties.get("metaDataProperty.GeocoderMetaData.AddressDetails.Country.AdministrativeArea.SubAdministrativeArea.Locality.LocalityName");if(d!=undefined){for(b in c){if(d.indexOf(b)!=-1){return showCityDialog(b,c[b])}}}d=a.geoObjects.get(0).properties.get("metaDataProperty.GeocoderMetaData.AddressDetails.Country.AdministrativeArea.SubAdministrativeArea.SubAdministrativeAreaName");if(d!=undefined){for(b in c){if(d.indexOf(b)!=-1){return showCityDialog(b,c[b])}}}d=a.geoObjects.get(0).properties.get("metaDataProperty.GeocoderMetaData.AddressDetails.Country.AdministrativeArea.AdministrativeAreaName");if(d!=undefined){for(b in c){if(d.indexOf(b)!=-1){return showCityDialog(b,c[b])}}}return true}function topButton(a){$("#top").click(function(){$("body, html").animate({scrollTop:a},1000)});$(window).scroll(function(){if($(window).scrollTop()>$("aside").height()+a&&$(window).scrollTop()<$("#contentBox").height()+150){$("#top").fadeIn()}else{$("#top").fadeOut()}})}function selectInit(){$(".select").each(function(){var a=$(this);$(a).find("a").on("click",function(){if($(this).is(":focus")){$(this).focus()}return false});if($(a).find('input[type="text"]').length){$(a).find('input[type="text"]').val($(a).find("li:first").text());$(a).find('input[type="hidden"]').val($(a).find("li:first").attr("data-value"))}if($(a).find("li").size()>1){$(a).find('input[type="text"]').addClass("combo");$(a).find("li").on("click",function(){$(a).find("span").html($(this).html());$(a).find('input[type="text"]').val($(this).text());$(a).find('input[type="hidden"]').val($(this).attr("data-value")).change();$(a).find("a").blur()})}})}function itemButton(){if($(".product-item").length){$(".product-item button.btn--green").off("click").on("click",function(a){a.stopPropagation();addToCart($(this).closest(".product-item"))})}}function canOrderBonus(){var a=$("#bonus-items");if(!$(a).length){return}if($(".cart-pane").attr("data-score")=="1"){$(a).hide();return}if($(".main-header_user .tooltip").length){var b=parseInt($(".main-header_user .user-info_ball").attr("data-score"));$(a).find(".product-item").each(function(){var c=parseInt($(this).attr("data-work"));if(c){var d=parseInt($(this).find(".product-item_bonus:first span").text());if(b>=d){$(this).find("button").removeAttr("disabled").removeClass("btn--grey").addClass("btn--green")}else{$(this).find(".b-tooltip").html("У вас не хватает баллов")}}})}else{$(a).find(".product-item").each(function(){var c=parseInt($(this).attr("data-work"));if(c){$(this).find("button").removeAttr("disabled").removeClass("btn--grey").addClass("btn--green")}})}$(a).find(".product-item button.btn--green").click(function(c){c.preventDefault();addToCart($(this).closest(".product-item"))})}function addToCart(f){var c=$(f).attr("data-id"),j=$(f).attr("data-type"),l=$(f).attr("data-constructor");if(j=="item"&&l=="2"){constructors.load(f);return}$.get("/ajax?action=addToCart&id="+c+"&type="+j+"&r="+Math.random(),function(p){if(p!="false"){var o=p.split(":");if(o.length>1){$(".cart-pane__item > .cart-pane__number").text(o[0]);$(".cart-pane__sum").text(o[1]+" P")}}});var h=$(".cart-pane");$(h).slideDown();var g=$(f).find("img:first").clone().addClass("move-img");$("body").append(g);var i=$(f).find("img").offset(),d=$(".cart-pane__logo").offset();g.css({position:"absolute",top:i.top,left:i.left,opacity:0.8,"border-radius":"0","z-index":1000});g.animate({left:d.left,top:d.top,opacity:0,width:50,height:50,borderRadius:"50%"},500,function(){$(".move-img").remove()});if(j=="bonus"){$("#bonus-items").slideUp();$(h).attr("data-score","1")}if(j=="item"){if(typeof m==="undefined"){var m=[]}var b={type:"CART_ADD",site_id:"479",product_id:c,product_price:$(f).find(".product-item_bonus span").text()};m.push(b);var e=(typeof __GetI_domain)=="undefined"?"px.adhigh.net":__GetI_domain;b.forward_tag=b.forward_tag||false;var a=("https:"==document.location.protocol?"https://":"http://")+e+"/p.js";var k=document.createElement("script");k.type="text/javascript";k.src=a;var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(k,n)}}function removeCard(b,a){$(a).parents(".card-item").slideUp(200);$.get("/ajax?action=removeCard&id="+b+"&r="+Math.random());return false}function cashPayment(a){$.get("/ajax?action=cashPayment&id="+a+"&r="+Math.random(),function(b){if(b!="false"){window.location=b}});return false}function setFavorite(f,e){var c=1,d;if(e==1){$.get("/ajax?action=favoriteAdd&id="+f+"&r="+Math.random());if($(".favorite").length){d=parseInt($("#restoran-page").attr("data-id"));if(f==d){$(".favorite i").removeClass("sprite-fav-off").addClass("sprite-fav-on");$(".favorite a").text("В избранном").attr("onclick","return setFavorite("+f+", 0);")}}}else{$.get("/ajax?action=favoriteRemove&id="+f+"&r="+Math.random());if($(".favorite").length){d=parseInt($("#restoran-page").attr("data-id"));if(f==d){$(".favorite i").removeClass("sprite-fav-on").addClass("sprite-fav-off");$(".favorite a").text("В избранное").attr("onclick","return setFavorite("+f+", 1);")}}c=-1}var b=$(".tooltip_title--star .notice");if($(b).length){var a=parseInt($(b).text())+c;if(a>0){$(".tooltip_title--star .notice, .cart-pane .tooltip .cart-pane__number").text(a)}else{$(b).remove();$(".cart-pane .tooltip .cart-pane__number").text("0")}}else{if(c==1){$('<span class="notice">1</span>').appendTo(".tooltip_title--star");$(".cart-pane .tooltip .cart-pane__number").text("1")}}return false}function userLogin(){var a={};$(".modal-login input").each(function(){a[$(this).attr("name")]=$(this).val()});$.post("/ajax?action=login",a,function(b){if(b=="true"){location.reload()}else{if(b=="sms"){sms.show(a.phone)}else{if(b=="false"){b="Произошла ошибка, <br> попробуйте повторить запрос."}$(".modal-login > a").click();$(".modal-login .text-center").css("color","red").html(b)}}});$(".modal-loader a").click();return false}var sms={time:40,phone:"",cart:false,show:function(a){sms.phone=a;$(".modal-sms .info span").html(sms.phone);$('.modal-sms input[name="phone"]').val(sms.phone);$(".modal-sms > a").click();sms.time=40;sms.timer()},timer:function(){sms.time-=1;if(sms.time>0){$(".modal-sms .modal-login_text span").text("через "+sms.time+" "+decOfNum(sms.time,["секунду","секунды","секунд"]));setTimeout(sms.timer,1000)}else{$(".modal-sms .modal-login_text span").text("")}},login:function(){var a={};$(".modal-sms input").each(function(){a[$(this).attr("name")]=$(this).val()});a.phone=sms.phone;$.post("/ajax?action=login.sms",a,function(b){if(b=="true"){if(sms.cart){makeOrder(false);return}location.reload()}else{if(b=="false"){b="Произошла ошибка, <br> попробуйте повторить запрос."}$(".modal-sms > a").click();$(".modal-sms .modal_note").css("color","red").html("<br>"+b)}});$(".modal-loader a").click();return false},repeat:function(){if(sms.time==0){$.post("/ajax?action=login",{phone:sms.phone},function(a){if(a=="sms"){sms.show(sms.phone)}else{if(a=="false"){a="Произошла ошибка, <br> попробуйте повторить запрос."}$(".modal-sms > a").click();$(".modal-sms .modal_note").css("color","red").html("<br>"+a)}});$(".modal-loader a").click()}return false}};function userReg(){var b={};var a=false;$(".modal-registration input").each(function(){if($(this).prop("required")&&$(this).val()==""){$(this).addClass("error");a=true}else{$(this).removeClass("error")}b[$(this).attr("name")]=$(this).val()});if(a){return false}$.post("/ajax?action=userReg",b,function(c){if(c=="true"){location.reload();dataLayer.push({event:"registration"})}else{if(c=="false"){c="Произошла ошибка, <br> попробуйте повторить запрос."}$(".modal-registration > a").click();$(".modal-registration .text-center").css("color","red").css("padding-top","10px").html(c)}});$(".modal-loader a").click();return false}function userFastReg(b){var c={};var a=false;$(b).find("input").each(function(){if($(this).prop("required")&&$(this).val()==""){$(this).addClass("error");a=true}else{$(this).removeClass("error")}c[$(this).attr("name")]=$(this).val()});if(a){return false}$.post("/ajax?action=userFastReg",c);$(b).fadeOut("normal",function(){$(b).html('<p class="ty_reg_fast">Через несколько минут Вам придет письмо с логином и паролем, для доступа в личный кабинет</p>').fadeIn("normal");dataLayer.push({event:"registr_typ"})});return false}function userExit(){$.get("/ajax?action=userExit&r="+Math.random(),function(){location.reload()});$(".modal-loader a").click();return false}function sendFromPrivate(){var a={};$(".modal-private input, .modal-private textarea").each(function(){if($(this).val()==""){return false}a[$(this).attr("name")]=$(this).val()});$(".modal-private textarea").val("");$.post("/ajax?action=sendFromPrivate",a,function(){$(".modal-confirm a").click()});$(".modal-loader a").click();return false}function reviewSubscribe(){var a={};$(".modal-reviews input").each(function(){if($(this).val()==""){return false}a[$(this).attr("name")]=$(this).val()});$('.modal-reviews input[name="email"]').val("");$.post("/ajax?action=review.subscribe.add",a,function(){location.reload()});$(".modal-loader a").click();return false}function removeReviewSubscribe(c,b){var a=$(b).closest("div.mail").find("div").text();$.post("/ajax?action=review.subscribe.remove",{org_id:c,email:a});$(b).closest("div.mail").slideUp();return false}function sendFeedback(){var a={};$(".modal-support input, .modal-support textarea").each(function(){if($(this).val()==""){return false}a[$(this).attr("name")]=$(this).val()});$(".modal-support textarea").val("");$.post("/ajax?action=sendFeedback",a,function(){$(".modal-confirm a").click()});$(".modal-loader a").click();return false}function getParameterByName(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c=new RegExp("[\\?&]"+a+"=([^&#]*)"),b=c.exec(location.search);return b==null?"":decodeURIComponent(b[1].replace(/\+/g," "))}function forgotPassword(){var a={};$(".modal-recovery input").each(function(){if($(this).val()==""){return false}a[$(this).attr("name")]=$(this).val()});$.post("/ajax?action=forgotPassword",a,function(b){if(b=="true"){$(".modal-confirm a").click()}else{if(b=="false"){b="Произошла ошибка, <br> попробуйте повторить запрос."}$(".modal-recovery .info").css("color","red").html(b);$(".modal-recovery > a").click()}});$(".modal-loader a").click();return false}function changePassword(){var a={};a.token=getParameterByName("forgotPassword");$(".modal-forgot input").each(function(){if($(this).val()==""){return false}a[$(this).attr("name")]=$(this).val()});$.post("/ajax?action=changePassword",a,function(b){if(b=="true"){window.location="/"}else{if(b=="false"){b="Произошла ошибка, <br> попробуйте повторить запрос."}$(".modal-forgot .info").css("color","red").html(b);$(".modal-forgot > a").click()}});$(".modal-loader a").click();return false}function sendPartnerForm(){var a={};$(".modal-partners input, .modal-partners textarea").each(function(){a[$(this).attr("name")]=$(this).val()});if(a.title==""||a.city==""||a.name==""||a.phone==""){return false}$(".modal-partners textarea").val("");$.post("/ajax?action=sendPartnerForm",a,function(){$(".modal-confirm a").click()});$(".modal-loader a").click();return false}var photoCss={};function previewPhoto(b){if(photoCss.background==undefined){var c=$(".profile-page_profile-image");photoCss.background=$(c).css("background");photoCss["background-size"]=$(c).css("background-size")}if(b.files&&b.files[0]){var a=new FileReader();a.onload=function(d){$(".profile-page_profile-image").css("background","url("+d.target.result+") no-repeat center").css("background-size","cover");$("#removePhoto").val("false")};a.readAsDataURL(b.files[0])}else{$(".profile-page_profile-image").css("background",photoCss.background).css("background-size",photoCss["background-size"])}}function removePhoto(){$(".profile-page_profile-image").css("background","url(/img/upload-photo-bg.png) no-repeat center center/50% auto").css("background-size","");$("#upload").val("");$("#removePhoto").val("true");return false}function setImputMask(){var a={onKeyPress:function(b,c,d){if(b.indexOf("+7 (89")!=-1||b.indexOf("+7 (79")!=-1){$(d).val("+7 (9")}}};$('form input[type="tel"]').focus(function(){if(this.value.length==0){this.value="+7 (";if(this.setSelectionRange){this.setSelectionRange(this.value.length,this.value.length)}}}).blur(function(){if(this.value=="+7 ("){this.value=""}}).mask("+7 (000) 000-00-00",a)}function saveSettings(){var b=$("#in4");var d=$("#in3").val(),c=$(b).val(),a="";if(d.length>0&&d.length<3){a="Необходим пароль от 3-х символов"}if(d.length>0&&d!=c){a="Указанные пароли не совпадают"}if(a!=""){$(b).closest("div").find("p").remove();$("html, body").animate({scrollTop:$("#in1").offset().top},400);$(b).after('<p style="color:red">'+a+"</p>");return false}return true}function addReview(b){var a={};a.id=$(b).attr("data-id");a.text=$(b).find("textarea").val();a.rate=parseInt($(b).find("input").val());a.like="";if(a.rate>0){$(b).find('input[name="like[]"]:checked').each(function(){a.like+=$(this).val()+","});$(b).slideUp("fast",function(){$(b).html('<div class="review-result"><b>Спасибо за отзыв!</b><br>Скоро он появится на сайте.</div>').slideDown();$("body, html").animate({scrollTop:410},500)});$.post("/ajax?action=addReview",a)}else{$(".review-error").slideDown()}return false}function removeItem(b,a){$.get("/cart?action=removeCartItem&ajax=1&id="+b+"&org_id="+a+"&r="+Math.random(),function(c){cartUpdate(c)});$("#item"+b).slideUp(200)}function removeConstructor(b,a){$.get("/cart?action=removeCartConstructor&ajax=1&id="+b+"&org_id="+a+"&r="+Math.random(),function(c){cartUpdate(c)});$("#constructor"+b).slideUp(200)}function removeOrg(a){$.get("/cart?action=removeCartOrg&ajax=1&id="+a+"&r="+Math.random(),function(b){cartUpdate(b)});$("#org"+a).slideUp(200)}function incrementItem(e,c,d){var b=$("#item"+e);var a=parseInt($(b).find("input").val());if(d==-1&&a==1){removeItem(e,c);return false}$.get("/cart?action=incrementCartItem&ajax=1&id="+e+"&org_id="+c+"&value="+d+"&r="+Math.random(),function(f){cartUpdate(f)});$(b).find("input").val(a+d);return false}function incrementConstructor(e,c,d){var b=$("#constructor"+e);var a=parseInt($(b).find("input").val());if(d==-1&&a==1){removeConstructor(e,c);return false}$.get("/cart?action=incrementCartConstructor&ajax=1&id="+e+"&org_id="+c+"&value="+d+"&r="+Math.random(),function(f){cartUpdate(f)});$(b).find("input").val(a+d);return false}function removeBonus(b,a){$.get("/cart?action=removeCartBonus&ajax=1&org_id="+a+"&r="+Math.random(),function(c){cartUpdate(c)});$("#score"+b).slideUp(400);return false}function removeFromCombo(c,b,a){$.get("/cart?action=removeFromCombo&ajax=1&id="+b+"&org_id="+a+"&combo_id="+c+"&r="+Math.random(),function(e){cartUpdate(e)});$("#combo"+b).slideUp(400);return false}function cartUpdate(e){if(e.indexOf("b-empty")!=-1&&document.referrer!=""){var c=window.location.hostname.split(".").slice(-2).join(".");if(document.referrer.indexOf(c)!=-1){window.location=document.referrer;return false}}var b={},a=$(".cart-form input, .cart-form textarea");$(a).each(function(){b[$(this).attr("name")]=$(this).val()});$("#contentBox").html(e);selectInit();setImputMask();setStreetLive();$(a).each(function(){if($(this).attr("type")=="radio"){return}if(b[$(this).attr("name")]!==undefined){$(this).val(b[$(this).attr("name")]);if($(this).closest(".select").length){var d=$(this).closest(".select"),f=$(d).find('li[data-value="'+b[$(this).attr("name")]+'"]').text();$(d).find("span").text(f)}}})}function makeOrder(a){var c={};var b=false;$(".cart-form input, .cart-form textarea").each(function(){if($(this).attr("type")=="radio"&&$(this).prop("checked")==false){return}if($(this).attr("name")=="phone"&&$(this).val().length<18){$(this).addClass("error");b=true}else{if($(this).prop("required")&&$(this).val()==""){$(this).addClass("error");b=true}else{$(this).removeClass("error")}}c[$(this).attr("name")]=$(this).val()});if(b){return false}if(a){if(c.street!=$('.cart-form input[name="street"]').attr("data-value")||c.home!=$('.cart-form input[name="home"]').attr("data-value")){addCartAddress(c);return false}}$.post("/ajax?action=order.create",c,function(f){if(f=="false"){location.reload()}else{if(f=="ban"){window.location="/ban"}else{if(f=="sms"){sms.cart=true;sms.show(c.phone)}else{if(f=="need_bonus"){$(".modal-need_bonus > a").click()}else{var e=JSON.parse(f);if(e.result=="online"){payonline.cart(e.orders,e.price);return}if(e.result=="refusal"){modal.load("refusal");return}if(e.result=="accept"){window.location="/accept?order="+e.orders;return}if(e.result=="3ds"){$(e.data).appendTo("body");return}window.location="/accept?order="+e.orders}}}}});$(".modal-loader a").click();return false}function addCartAddress(b){var c=$(".cart-form").attr("data-city");var a=c+", "+b.street+", дом "+b.home+(b.building==""?"":"/"+b.building);if(c.indexOf("область")==-1){a="Город "+a}$.ajax({url:"https://geocode-maps.yandex.ru/1.x/?format=json&geocode="+encodeURIComponent(a)+"&callback=?",type:"GET",dataType:"jsonp",jsonpCallback:"cartJsonpCallback"});$(".modal-loader a").click();return false}function cartJsonpCallback(g){var l=[],i,h,j={};if(g.response.GeoObjectCollection.featureMember.length>0){var d=g.response.GeoObjectCollection.featureMember;for(i in d){var f=d[i].GeoObject.metaDataProperty.GeocoderMetaData.kind;if(f=="house"){l.push(d[i])}}}if(l.length==1){h=searchGeoParam(l[0],"pos");var c=h.split(" ");j.name=searchGeoParam(l[0],"formatted");j.coord=c[1]+","+c[0];j.street=searchGeoParam(l[0],"ThoroughfareName");if(j.street==""){j.street=searchGeoParam(l[0],"DependentLocalityName")}j.house=searchGeoParam(l[0],"PremiseNumber");j.flat=$('.cart-form input[name="flat"]').val();j.comment=$('.cart-form textarea[name="comment"]').val();$.post("/ajax?action=address.new",j,function(m){if($.isNumeric(m)){$.cookie("zakaPoint",m,{expires:1000,path:"/"})}makeOrder(false)})}else{if(l.length>1){$(".rectification_address").html("");for(i in l){h=searchGeoParam(l[i],"pos");var k=searchGeoParam(l[i],"AddressLine"),e=searchGeoParam(l[i],"ThoroughfareName"),a=searchGeoParam(l[i],"PremiseNumber"),b=searchGeoParam(l[i],"formatted");if(e==""){e=searchGeoParam(l[i],"DependentLocalityName")}c=h.split(" ");$('<a href="#" data-coord="'+c[1]+","+c[0]+'" data-street="'+e+'" data-house="'+a+'" data-name="'+b+'">'+k+"</a>").appendTo(".rectification_address")}$(".modal-rectification > a").click();$(".rectification_address a").click(function(m){m.preventDefault();$(".modal-loader a").click();j.name=$(this).attr("data-name");j.coord=$(this).attr("data-coord");j.street=$(this).attr("data-street");j.house=$(this).attr("data-house");j.flat=$('.cart-form input[name="flat"]').val();j.comment=$('.cart-form textarea[name="comment"]').val();$.post("/ajax?action=address.new",j,function(n){if($.isNumeric(n)){$.cookie("zakaPoint",n,{expires:1000,path:"/"})}makeOrder(false)})})}else{$(".modal-noaddr > a").click()}}$(".header_button").prop("disabled",false)}var payonline={orders:"",price:0,cart:function(a,b){payonline.orders=a;payonline.price=b;$(".online-total span").text(b.toString()+" P");payonline.show();return false},user:function(){$(".online-total span").text("1 P");payonline.show();return false},show:function(){var c=parseInt(new Date().getFullYear()),b="";for(var a=c;a<c+20;a++){b+='<option value="'+a+'">'+a+"</option>"}$("#card_year").html(b);$(".modal-online > a").click()},make:function(){var a={};a.card_pan=$("#card_pan").val();if(a.card_pan==""){alert("Укажите номер карты");return false}a.card_cvc=$("#card_cvc").val();if(a.card_cvc==""){alert("Укажите CVC/CVV код с обратной стороны карты");return false}a.card_year=$("#card_year").val();a.card_month=$("#card_month").val();a.card_name=$("#card_name").val();if(a.card_name==""){alert("Укажите имя вледельца карты");return false}a.ids=payonline.orders;$.post("/ajax?action=payonline",a,function(b){if(b=="false"||b=="refusal"){$(".modal-refusal a").click()}else{if(b=="accept"){window.location="/accept?order="+payonline.orders}else{$(b).appendTo("body")}}});$(".modal-loader a").click();return false}};function showCityDialog(b,a){if(b==$("#current-city").text()){return true}$(".modal-city form").attr("action",a);$(".modal-city .modal_title span").text(b+"?");$(".modal-city > a").click();$(".modal-city .btn--green").click(function(){window.location=a});$(".modal-city .btn--grey").click(function(){$(".modal-city .js-close-modal").click();$("html, body").animate({scrollTop:0},400);$("#city-select").closest(".tooltip").addClass("tooltip--open");return false});return false}function orderReason(){var a=$("#reasonForm");var c=$(a).find("input:checked").val(),d="";if(c=="0"){d=$(a).find('input[name="other"]').val()}else{d=$(a).find("input:checked").next("label").text()}if(d==""){return false}var b={};b.reason=c;b.text=d;b.token=$(a).attr("data-order");$.post("/ajax?action=orderReason",b,function(){$(".ty_form").hide();$(".ty_title").text("Заказ отменен")});return false}function onlineAmountCorrect(){var b=$("#onlineAmountCorrect");var a=$(b).find("input").val();a=parseInt(a);var c={};c.amount=a;c.token=$(b).attr("data-order");$.post("/ajax?action=orderAmountCorrect",c,function(e){if(e=="true"){$(b).html("Информация изменена!")}else{$(b).html('<div class="error">Произошла ошибка!<br><br>Для изменения сумы заказа свяжитесь с нами по телефону.')}});return false}function showFullText(){$(".seo-org .readmore").hide();$(".seo-org-overflow").removeClass("shadow").animate({"max-height":$(".seo-org-overflow")[0].scrollHeight},500);return false}function isHhistoryApiAvailable(){return !!(window.history&&history.pushState)}function getUrl(b,a){if(isHhistoryApiAvailable){if(b!=window.location||a){$.get(b,{ajax:1},function(c){if(!a){window.history.pushState(null,null,b)}$("#contentBox").html(c);canOrderBonus();itemButton()})}}else{window.location=b}return false}function decOfNum(b,c){var a=[2,0,1,1,1,2];return c[(b%100>4&&b%100<20)?2:a[(b%10<5)?b%10:5]]}function orgClosing(){if($("#restoran-page").attr("data-work")=="0"){return false}var f=$(".before-closing");var c=$(f).attr("data-closing");if(c!=""&&c!=undefined){var g=new Date(),e=new Date(c),d=$(f).attr("data-type");if(e<g){$(f).html('<i class="sprite sprite-ico-clock-orange"></i> '+(d=="food"?"Магазин":"Ресторан")+" закрылся!");return false}var a=new Date(e-g);if(a<1800000){var b=a.getUTCMinutes()+1;$(f).html('<i class="sprite sprite-ico-clock-orange"></i> До закрытия '+(d=="food"?"магазина":"ресторана")+" осталось "+b+" "+decOfNum(b,["минута","минуты","минут"])+"!")}setTimeout(orgClosing,60000)}}function isValidEmail(b){var a=new RegExp(/^(("[\w-\s]+")|([\w-]+(?:\.[\w-]+)*)|("[\w-\s]+")([\w-]+(?:\.[\w-]+)*))(@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][0-9]\.|1[0-9]{2}\.|[0-9]{1,2}\.))((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\]?$)/i);return a.test(b)}function customerSubscribe(){var b=$("#subscribe");var a=$(b).find("input").val();if(a==undefined||a==""||!isValidEmail(a)){return false}$.post("/ajax?action=subscribe",{email:a});$(b).find("input").val("");$(b).find(".col:last").html('<div class="adding"><span class="title">Списибо</span><br>e-mail добавлен</div>');return false}var constructors={id:0,load:function(a){constructors.id=$(a).closest(".product-item").attr("data-id");$.get("/objects?action=get.constructor&id="+constructors.id+"&r="+Math.random(),function(c){if(c==""){return}if(c!="false"){$(c).appendTo("#modal");var b=$(".modal-constructor");$(".modal-overlay:first").addClass("modal-overlay--open");$(b).css("top",$(window).scrollTop()+"px").addClass("modal--open");$(b).find(".catalog input").change(constructors.select);constructors.select()}});return false},inc:function(c){var a=$(".modal-constructor .item-count");var b=parseInt($(a).val());if(c==-1&&b==1){return false}$(a).val(b+c)},close:function(){$(".modal-constructor").remove();$(".modal-overlay").removeClass("modal-overlay--open");return false},select:function(){var a=parseInt($(".constructor-box").attr("data-price"));$(".constructor-box .catalog input:checked").each(function(){a+=parseInt($(this).attr("data-price"))});$(".modal-constructor .footer .price").text(a)},order:function(){var a={};a.id=constructors.id;a.count=$(".constructor-box .item-count").val();a.addons=[];$(".constructor-box .catalog input:checked").each(function(){a.addons.push($(this).val())});$.post("/ajax?action=addConstructorToCart",a,function(b){if(b!="false"){a=b.split(":");if(a.length>1){$(".cart-pane__item > .cart-pane__number").text(a[0]);$(".cart-pane__sum").text(a[1]+" P")}}});$(".cart-pane").slideDown();constructors.close()}};var ingredients={box:null,id:0,item:null,load:function(a){ingredients.item=$(a).closest(".product-item");ingredients.id=$(ingredients.item).attr("data-id");if(ingredients.box!=null){ingredients.close();if($(ingredients.box).find(".ingredients-box").attr("data-id")==ingredients.id){return false}}$.get("/objects?action=get.ingredients&id="+ingredients.id+"&r="+Math.random(),function(c){if(c==""){$(a).remove();return}if(c!="false"){ingredients.box=$(ingredients.item).closest(".items");var b=$(ingredients.box).find(".product-item").index(ingredients.item);$(ingredients.box).append(c);$(ingredients.box).find(".ingredients-box").slideDown();$(ingredients.box).find(".box").addClass("index"+b);$(ingredients.box).find(".catalog input").change(ingredients.select)}});return false},inc:function(c){var a=$(ingredients.box).find(".item-count");var b=parseInt($(a).val());if(c==-1&&b==1){return false}$(a).val(b+c)},close:function(){$(ingredients.box).find(".ingredients-box").slideUp("slow",function(){this.remove()});return false},select:function(){var b=parseInt($(this).attr("data-price")),a=parseInt($(ingredients.box).find(".footer .price").text());if(b>0){if($(this).is(":checked")){a+=b}else{a-=b}$(ingredients.box).find(".footer .price").text(a)}},order:function(){var a={};a.id=ingredients.id;a.count=$(ingredients.box).find(".item-count").val();a.addons=[];$(ingredients.box).find(".ingredients-box .catalog input:checked").each(function(){a.addons.push($(this).val())});$.post("/ajax?action=addConstructorToCart",a,function(b){if(b!="false"){a=b.split(":");if(a.length>1){$(".cart-pane__item > .cart-pane__number").text(a[0]);$(".cart-pane__sum").text(a[1]+" P")}}});$(".cart-pane").slideDown();ingredients.close()}};function setStreetLive(){$('.cart-form input[name="street"]').keyup(function(a){if($.inArray(a.which,[13,37,38,39,40])>=0){return}if($(this).val().length>2){$.post("/ajax?action=street.search",{search:$(this).val()},function(b){if(b=="false"||b==""){$(".address-live-box").hide()}else{$(".address-live-box").html(b).show()}})}else{$(".address-live-box").hide()}point=0}).keydown(function(a){hintSelector(a,".address-live-box")});$('.cart-form input[name="home"], .cart-form input[name="building"]').keyup(function(){point=0})}function hintSelector(g,d){var f=$(d+" a.selected");switch(g.which){case 40:if($(f).length){var b=$(f).next("a");if($(b).length){$(f).removeClass("selected");$(b).addClass("selected")}}else{$(d+" a:first").addClass("selected")}g.preventDefault();break;case 38:if($(f).length){var c=$(f).prev("a");if($(c).length){$(f).removeClass("selected");$(c).addClass("selected")}}g.preventDefault();break;case 13:if($(f).length){var a=$(f).attr("href");if(a=="#"){$(f).click()}else{window.location=a}g.preventDefault()}break}};